# 예측 데이터셋 생성 가이드

이 디렉토리는 ML 모델을 사용하여 가격 및 품질 예측 데이터셋을 생성하는 스크립트를 포함하고 있습니다.

## 파일 구조

```
data/
├── raw/                    # 원본 데이터 (CSV, JSON)
│   ├── 농넷_시장별_사과가격.csv
│   ├── 초창패개발_데이터_판매데이터.csv
│   ├── 초창패개발_데이터_CS데이터.csv
│   └── weather_data.json
└── processed/              # 예측 결과 데이터
    ├── create_predictions.py  # 예측 데이터셋 생성 스크립트
    ├── price_predictions_*.csv    # 가격 예측 결과
    └── quality_predictions_*.csv  # 품질 예측 결과
```

## 사용 방법

### 1. 필수 패키지 설치

```bash
pip install pandas numpy scikit-learn joblib lightgbm xgboost torch
```

### 2. 스크립트 실행

#### 모든 예측 수행 (가격 + 품질)

```bash
python data/processed/create_predictions.py --model_type all
```

#### 가격 예측만 수행

```bash
python data/processed/create_predictions.py --model_type price
```

#### 품질 예측만 수행

```bash
python data/processed/create_predictions.py --model_type quality
```

#### 사용자 정의 경로 지정

```bash
python data/processed/create_predictions.py \
    --model_type all \
    --raw_data_path /path/to/raw \
    --output_dir /path/to/output
```

## 출력 데이터 형식

### 가격 예측 결과 (price*predictions*\*.csv)

| 컬럼명        | 설명                        |
| ------------- | --------------------------- |
| DATE          | 거래 날짜                   |
| 도매시장      | 도매시장명                  |
| 품종          | 사과 품종                   |
| 산지-광역시도 | 산지 광역시도               |
| 산지-시군구   | 산지 시군구                 |
| 등급          | 품질 등급                   |
| 평균가격      | 원본 데이터의 평균가격      |
| 실제가격      | 실제 거래 가격              |
| **예측가격**  | **ML 모델이 예측한 가격**   |
| 가격차이      | 예측가격 - 실제가격         |
| 가격차이율(%) | (가격차이 / 실제가격) × 100 |

**예시:**

```csv
DATE,도매시장,품종,산지-광역시도,산지-시군구,등급,평균가격,실제가격,예측가격,가격차이,가격차이율(%)
2025-06-02,안동도매시장,감홍,경북,문경시,등외,20000.0,20000.0,20395.41,395.41,1.98
```

### 품질 예측 결과 (quality*predictions*\*.csv)

| 컬럼명             | 설명                                      |
| ------------------ | ----------------------------------------- |
| 발주날짜           | 주문 날짜                                 |
| 셀러코드           | 판매자 코드                               |
| 업체명             | 업체명                                    |
| 판매상품명         | 상품명                                    |
| 공급가격           | 공급 가격                                 |
| CS여부             | 실제 CS 발생 여부 (Y/N)                   |
| 실제\_CS여부       | CS 여부를 숫자로 변환 (1/0)               |
| **예측\_하자확률** | **ML 모델이 예측한 하자 발생 확률 (0~1)** |
| **예측\_CS여부**   | **예측 하자 여부 (0.5 임계값 기준)**      |
| 예측정확           | 예측이 실제와 일치하는지 여부             |

**예시:**

```csv
발주날짜,셀러코드,업체명,판매상품명,공급가격,CS여부,실제_CS여부,예측_하자확률,예측_CS여부,예측정확
2025-05-26,2124,도매GB,(행사용)(도매GB)부사쥬스용/6kg,15000.0,N,0,0.0001,0,1
```

## 주요 특징

### 가격 예측 모델

- **모델**: LightGBM, XGBoost, Random Forest 앙상블
- **예측 대상**: 사과 도매 가격
- **특징**:
  - 시간 특성 (연, 월, 일, 요일, 분기)
  - 계절 특성 (봄, 여름, 가을, 겨울)
  - 날씨 정보 (온도, 습도, 강수량, 풍속)
  - 시계열 특성 (7일/14일/30일 이동평균)

### 품질 예측 모델

- **모델**: LightGBM, XGBoost, Random Forest, Gradient Boosting 앙상블
- **예측 대상**: CS(Customer Service) 발생 확률
- **특징**:
  - 셀러/업체별 과거 CS 발생률
  - 시간 특성 및 계절 특성
  - 날씨 정보
  - 상품 가격 및 중량 정보
  - 불균형 데이터 처리 적용

## 성능 지표

최근 실행 결과:

### 가격 예측 성능

- 총 샘플 수: 32,208개
- 평균 절대 오차: 2,726원
- 평균 절대 오차율: **3.61%**

### 품질 예측 성능

- 총 샘플 수: 51,936개
- 실제 CS 발생률: 0.21%
- 예측 정확도: **99.74%**
- CS 샘플 예측 정확도: **92.79%**
- CS 샘플 평균 예측 확률: 0.7574
